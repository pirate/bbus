---
title: PostgresEventBridge
description: Forward events using PostgreSQL LISTEN/NOTIFY plus table storage.
---

`PostgresEventBridge` stores event payloads in a Postgres table and uses `LISTEN/NOTIFY` for low-latency fanout.

## Optional dependencies

<Tabs>
<Tab title="Python">

Install the Postgres extra (recommended):

```bash
pip install "bubus[postgres]"
```

Equivalent direct dependency install:

```bash
pip install asyncpg
```

</Tab>
<Tab title="TypeScript">

Install the Postgres client package:

```bash
npm install bubus pg
```

This bridge is Node.js-only.

</Tab>
</Tabs>

## Constructor params

- `table_url`: `postgresql://user:pass@host:5432/dbname[/tablename]?...`
- `channel`: optional notify/listen channel (defaults to `bubus_events`)
- `name`: optional bridge label

<Tabs>
<Tab title="Python">

```python
from bubus import PostgresEventBridge

bridge = PostgresEventBridge(
    'postgresql://user:pass@localhost:5432/mydb/bubus_events',
    channel='bubus_events',
    name='PgBridge',
)
```

</Tab>
<Tab title="TypeScript">

```ts
import { PostgresEventBridge } from 'bubus'

const bridge = new PostgresEventBridge(
  'postgresql://user:pass@localhost:5432/mydb/bubus_events',
  'bubus_events',
  'PgBridge'
)
```

</Tab>
</Tabs>

## Setup with a bus

<Tabs>
<Tab title="Python">

```python
from bubus import EventBus, PostgresEventBridge

bus = EventBus('AppBus')
bridge = PostgresEventBridge('postgresql://user:pass@localhost:5432/mydb/bubus_events')

bus.on('*', bridge.emit)
bridge.on('*', bus.emit)
```

</Tab>
<Tab title="TypeScript">

```ts
import { EventBus, PostgresEventBridge } from 'bubus'

const bus = new EventBus('AppBus')
const bridge = new PostgresEventBridge('postgresql://user:pass@localhost:5432/mydb/bubus_events')

bus.on('*', bridge.emit)
bridge.on('*', bus.emit)
```

</Tab>
</Tabs>

## Behavior

- `emit(...)` upserts event payload data into the bridge table, then sends `NOTIFY` with the event id.
- `on(...)` registers inbound handlers and auto-starts listener startup.
- On notifications, the bridge fetches the full row payload, reconstructs an event, resets it, and emits locally.
- Columns are created on demand only for `event_*` fields.
- The full event JSON is stored in `event_payload` (not just non-`event_*` fields).
- `event_*` columns are also stored as flat mirrored fields for indexing/querying.
- Rehydration merges `event_payload` with `event_*` column values back into a flat event object.
- Runtime requirements: Python needs `asyncpg`, TypeScript needs `pg` and Node.js.
